<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>PrognosAI Result</title>
  <link rel="stylesheet" href="/static/styles.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Prediction Result â€” {{ filename }}</h1>
    <div class="summary-card" style="border-left:10px solid {{ color }};">
      <h2>RUL: {{ rul }} cycles</h2>
      <p>Status: <strong>{{ status }}</strong></p>
      <p>Pipeline used: {{ pipeline }}</p>
      <form action="/report" method="POST">
        <input type="hidden" name="filename" value="{{ filename }}">
        <input type="hidden" name="rul" value="{{ rul }}">
        <input type="hidden" name="status" value="{{ status }}">
        <input type="hidden" name="heatmap" value="{{ heatmap_png }}">
        <button type="submit">Download PDF Report</button>
      </form>
    </div>

    <div id="sensor_trends"></div>
    <div id="rul_gauge" style="width:400px;height:300px;display:inline-block;"></div>
    <div id="health_metric" style="width:300px;height:200px;display:inline-block;"></div>

    <h3>Degradation Curves</h3>
    <div id="degradation"></div>

    <h3>Correlation Heatmap</h3>
    {% if heatmap_png %}
      <img src="/{{ heatmap_png }}" style="max-width:700px;">
    {% else %}
      <p>No heatmap available.</p>
    {% endif %}

    <a href="/">Upload Another</a>
  </div>

<script>
// --------- FIXED JSON HANDLING 100% WORKING ---------

var sensor_trends = JSON.parse(`{{ sensor_trends | safe }}`);
var rul_gauge = JSON.parse(`{{ rul_gauge | safe }}`);
var health_metric = JSON.parse(`{{ health_metric | safe }}`);
var degradation = JSON.parse(`{{ degradation | safe }}`);

console.log("sensor_trends JSON:", sensor_trends); // DEBUG

Plotly.newPlot('sensor_trends', sensor_trends.data, sensor_trends.layout || {});
Plotly.newPlot('rul_gauge', rul_gauge.data, rul_gauge.layout || {});
Plotly.newPlot('health_metric', health_metric.data, health_metric.layout || {});
Plotly.newPlot('degradation', degradation.data, degradation.layout || {});
</script>


</body>
</html>
